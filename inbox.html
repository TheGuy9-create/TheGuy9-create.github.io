<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Inbox</title>

<style>
body { font-family: Arial; background: #f4f4f4; }

#modMenu {
    position: fixed;
    right: 20px;
    top: 20px;
    width: 200px;
    background: white;
    border: 2px solid black;
    padding: 10px;
    display: none;
}
#modMenu button {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
}
</style>
</head>
<body>

<h2>Inbox</h2>

<!-- MOD MENU -->
<div id="modMenu">
    <h3>MOD MENU</h3>
    <button onclick="triggerSound('beep')">Beep</button>
    <button onclick="triggerSound('fart')">Fart</button>
    <button onclick="triggerSound('scream')">Scream</button>
</div>

<script>

// ============= LOGIN CHECK ============
let user = localStorage.getItem("user");
if (!user) window.location = "index.html";

// ============= SHOW MOD MENU FOR TEST ============
if (user === "Test") {
    document.addEventListener("keydown", function(e){
        if (e.key === "Tab") {
            e.preventDefault();
            let m = document.getElementById("modMenu");
            m.style.display = m.style.display === "none" ? "block" : "none";
        }
    });
}

// ============= TRIGGER SOUND FOR ALL USERS ============
function triggerSound(type) {
    fetch("sound.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ sound: type })
    });
}

// ============= PLAY SOUND LOCALLY ============
function playSound(name) {
    let audio = new Audio("uploads/" + name + ".mp3");
    audio.play();
}

// ============= CHECK FOR NEW SOUND EVERY 1s ============
let lastSound = "";

setInterval(() => {
    fetch("sound.php")
        .then(r => r.json())
        .then(data => {
            if (data.last && data.last !== lastSound) {
                lastSound = data.last;
                playSound(data.last);
            }
        });
}, 1000);

</script>

</body>
</html>
